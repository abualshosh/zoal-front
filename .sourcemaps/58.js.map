{"version":3,"sources":["../../src/pages/chat/messages/messages.module.ts","../../src/pages/chat/messages/messages.ts"],"names":[],"mappings":"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","file":"58.js","sourcesContent":["//import { SharedModule } from '../../../../app/shared.module';\nimport { MessagesPage } from './messages';\nimport { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\n\n@NgModule({\n  declarations: [\n    MessagesPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(MessagesPage),\n//    SharedModule,\n  ],\n  exports: [\n    MessagesPage\n  ]\n})\n\nexport class MessagesPageModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat/messages/messages.module.ts","import { FormControl, FormBuilder } from '@angular/forms';\nimport { Component, ViewChild } from '@angular/core';\nimport { IonicPage, NavController, Content, NavParams, } from 'ionic-angular';\nimport { Api,User } from '../../../providers/providers'\nimport { Events } from 'ionic-angular';\nimport { SQLite ,SQLiteObject  } from '@ionic-native/sqlite';\nimport { StompService } from 'ng2-stomp-service';\n@IonicPage()\n@Component({\n  selector: 'page-messages',\n  templateUrl: 'messages.html'\n})\nexport class MessagesPage {\n  toUser:any ;\nlast:boolean=false;\n  user:any;\nmessages:any=[];\n  doneLoading = false;\nlastindex:any=10;\n\n  @ViewChild(Content) contents: Content;\nCahtUser:string;\n  public messageForm: any;\n  chatBox: any;\n  mySubscribedHandler:any =  (greeting) => {\n\n    //    showGreeting(greeting.body);\n    console.log(greeting);\n  if (this.navCtrl.getActive().name == 'MessagesPage'&&greeting.sender==this.toUser._id) {\n    console.log(greeting);\n\n\n\n\n\n    this.messages.push({\n      toId: this.toUser._id,\n      _id: 6,\n      date: greeting.msgDate,\n      userId: this.toUser._id,\n      username: this.toUser.username,\n      pic: this.toUser.pic,\n      text: greeting.message    });\n\n  this.scrollToBottom();\n  }\n  }\n  constructor(\n    public stomp: StompService,\n    public sqlite:SQLite,public events: Events,public users:User,public navCtrl: NavController, public formBuilder: FormBuilder,public api:Api,navParams: NavParams,) {\nthis.CahtUser=navParams.get('otherUser');\n    this.user = {\n      _id: localStorage.getItem('username'),\n      pic: this.api.url+'/profileimage/'+localStorage.getItem('username'),\n      username: localStorage.getItem('username'),\n    };\n    this.toUser = {\n      _id: navParams.get('otherUser'),\n      pic: this.api.url+'/profileimage/'+navParams.get('otherUser'),\n      username: navParams.get('otherUser'),\n    };\nthis.messages=navParams.get('msg');\n\n\n\n    this.messageForm = formBuilder.group({\n      message: new FormControl('')\n    });\n    this.chatBox = '';\n\n    this.stomp.subscribe('/user/queue/status', this.response);\n    this.events.subscribe('message', this.mySubscribedHandler);\n  }\n  public response = (data) => {\n    console.log(data)\n        \n      }\n\n\nionViewWillLeave(){\n\n    this.events.unsubscribe('message', this.mySubscribedHandler);\n}\n  send(message) {\n    if (message && message !== '') {\n      // this.messageService.sendMessage(chatId, message);\n      var sender = this.user._id;\n      \tvar recipient = this.toUser._id;\n        var message = message;\n        var msgDate=new Date();\n        //  stompClient.send(\"/app/hello\", {}, JSON.stringify({ 'name': name }));\nthis.users.stomp.send(\"/app/message\",{ 'sender': sender,'recipient':recipient,'message':message ,msgDate:msgDate});\n//  this..send('destionation',{\"data\":\"data\"});\n      const messageData =\n        {\n          toId: this.toUser._id,\n          _id: 6,\n          date:msgDate ,\n          userId: this.user._id,\n          username: this.toUser.username,\n          pic: this.toUser.pic,\n          text: message\n        };\n\n  this.sqlite.create({\n        name: localStorage.getItem('username'),\n        location: 'default'\n      })\n        .then((db: SQLiteObject) => {\n\n\n\n      db.executeSql(`insert into messages(\n           chatId ,\n           otherUser ,\n           msg ,\n           msgDate\n      ) values (?,?,?,?)`, [this.toUser.username,this.user._id,message,msgDate]);\n\n      db.executeSql(`update chats set msg=? , msgDate=? where otheruser=?`,\n      [message,msgDate,this.toUser.username]).then(data => {\n     if(data.rowsAffected == 0){\n       db.executeSql(`insert into chats(\n         otherUser ,\n         msg ,\n         msgDate\n    ) values (?,?,?)`, [this.toUser.username,message,msgDate]);\n    \n     }\n       }, (e) => {\n   \n   \n       console.log(\"Errot: \" + JSON.stringify(e));\n       });\n\n      // for(var i = 0; i < this.chats.length; i++)\n      // {\n      //   if(this.chats[i].title==greeting.sender){\n      //     this.chats[i].lastMessage=greeting.message;\n      //     this.chats[i].timestamp=new Date();\n      //   }\n      // }\n\n }).catch(e => console.log(e));\n\n\n      this.messages.push(messageData);\n      this.events.publish('sending',messageData);\n      this.scrollToBottom();\n\n      // setTimeout(() => {\n      //   const replyData =\n      //     {\n      //       toId: this.toUser._id,\n      //       _id: 6,\n      //       date: new Date(),\n      //       userId: this.toUser._id,\n      //       username: this.toUser.username,\n      //       pic: this.toUser.pic,\n      //       text: 'Just a quick reply'\n      //     };\n      //   this.messages.push(replyData);\n      //   this.scrollToBottom();\n      // }, 1000);\n    }\n    this.chatBox = '';\n  }\ndoInfinite(refresher){\nlet startindex=this.lastindex;\n  this.sqlite.create({\n    name: localStorage.getItem('username'),\n    location: 'default'\n  })\n    .then((db: SQLiteObject) => {\n  db.executeSql(\"SELECT * FROM messages where chatid=? order by id desc limit ? offset ?\", [this.CahtUser,10,this.lastindex]).then(data => {\n\n  if(data.rows.length > 0) {\n    for(var i = 0; i < data.rows.length; i++)\n    {\n      this.messages.splice(0,0,{\n        toId: data.rows.item(i).otherUser,\n        _id: 6,\n        date: new Date(),\n        userId: data.rows.item(i).otherUser,\n        username: data.rows.item(i).otherUser,\n        pic: this.api.url+'/profileimage/'+data.rows.item(i).otherUser,\n        text: data.rows.item(i).msg    });\nthis.lastindex++;\n    }\n\n  }\n  if(startindex==this.lastindex){\n    this.last=true;\n  }\n  refresher.complete();\n  }, (e) => {\n\n\n  console.log(\"Errot: \" + JSON.stringify(e));\n  });\n})\n.catch(e =>\nalert(JSON.stringify(e)));\n}\n  scrollToBottom() {\n    setTimeout(() => {\nif(this.contents){\n      this.contents.scrollToBottom();\n  }}, 500);\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat/messages/messages.ts"],"sourceRoot":""}