<!--
  Generated template for the FeedsPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header color="bar">
  <ion-navbar color="secondary">
    <ion-title>{{ "feeds" | translate }}</ion-title>
  </ion-navbar>
</ion-header>
<ion-content no-padding style="background-color: #f0f0f0;">
  <img *ngIf="posts.length == 0" src="assets/img/nopost.png" />
  <ion-refresher (ionRefresh)="doRefresh($event)" color="primary">
    <ion-refresher-content color="primary"></ion-refresher-content>
  </ion-refresher>
  <div id="posts" *ngIf="posts.length >= 0">
    <ion-card *ngFor="let post of posts" no-padding>
      <ion-item class="itemDev">
        <ion-avatar
          item-start
          (click)="openOtherProfile('OtherProfilePage', post)"
        >
          <img-loader
            fallbackAsPlaceholde="true"
            fallback="assets/img/userPlaceholder.png"
            [src]="this.api.url + '/profileimage/' + post.profile.userName"
            useImg
          >
          </img-loader>
        </ion-avatar>
        <h2 class="sticky">{{ post.profile.fullName }}</h2>
        <p>{{ post.postDate | date: "dd/MM/yyyy hh:mm" }}</p>
      </ion-item>
      <ion-card-content (click)="openOtherProfile('ItemDetailPage', post)">
        <p>{{ post.postTxt }}</p>
      </ion-card-content>

      <img-loader
        *ngIf="post.haveImage"
        [src]="this.api.url + '/postimage/' + post.id"
        (click)="viewImage(post)"
        useImg
      >
      </img-loader>
      <ion-row>
        <ion-col>
          <button
            ion-button
            color="purple"
            clear
            small
            icon-left
            (click)="like(post)"
          >
            <ion-icon name="thumbs-up"></ion-icon>
            {{ post.posttolikes.length }} {{ "Likes" | translate }}
          </button>
        </ion-col>
        <ion-col>
          <button
            ion-button
            color="purple"
            clear
            small
            icon-left
            (click)="openOtherProfile('ItemDetailPage', post)"
          >
            <ion-icon name="text"></ion-icon>
            {{ post.posttocomments.length }} {{ "comments" | translate }}
          </button>
        </ion-col>
        <ion-col align-self-center text-center> <p></p> </ion-col>
      </ion-row>
    </ion-card>
  </div>
  <ion-infinite-scroll (ionInfinite)="doInfinite($event)" *ngIf="!this.last">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="Loading more data..."
    ></ion-infinite-scroll-content>
  </ion-infinite-scroll>
  <ion-fab end bottom>
    <button
      ion-fab
      color="primary"
      (click)="openOtherProfile('AddPostPage', '')"
    >
      <ion-icon name="create"></ion-icon>
    </button>
  </ion-fab>
</ion-content>
